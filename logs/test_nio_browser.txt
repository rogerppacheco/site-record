from crm_app.nio_api import consultar_dividas_nio
import json

cpf = '12886868620'

print('='*80)
print(f'ğŸ” CONSULTANDO CPF: {cpf}')
print('='*80)
print('\nâš ï¸ ABRINDO NAVEGADOR VISÃVEL...\n')

# HEADLESS=FALSE para ver o navegador
resultado = consultar_dividas_nio(cpf=cpf, limit=10, headless=False)

print('\n' + '='*80)
print('ğŸ“Š RESULTADO COMPLETO (JSON):')
print('='*80)
print(json.dumps(resultado, indent=2, ensure_ascii=False))

invoices = resultado.get('invoices', [])
print(f'\n{"="*80}')
print(f'TOTAL DE FATURAS RETORNADAS: {len(invoices)}')
print('='*80)

if invoices:
    inv = invoices[0]
    print(f'\n{"â”€"*80}')
    print('ANÃLISE DETALHADA DA FATURA:')
    print(f'{"â”€"*80}')
    print(f'\nğŸ“‹ Produto: {inv.get("product")}')
    print(f'ğŸ·ï¸  Origin: {inv.get("origin")}')
    print(f'ğŸ’° Valor: R$ {inv.get("amount")}')
    print(f'\nğŸ“… DATAS:')
    print(f'   due_date_raw: {inv.get("due_date_raw")} â† Data original do boleto')
    print(f'   expiration: {inv.get("expiration")} â† Data de expiraÃ§Ã£o estendida')
    print(f'   reference_month: {inv.get("reference_month")} â† MÃªs de referÃªncia')
    
    print(f'\nğŸ”– Status: {inv.get("status")}')
    print(f'ğŸ†” Deal Code: {inv.get("deal_code")}')
    print(f'ğŸ”‘ Debt ID: {inv.get("debt_id")}')
    
    barras = inv.get('barcode', '')
    pix = inv.get('pix', '')
    
    print(f'\nğŸ“Š CÃ“DIGO DE BARRAS:')
    print(f'   Tamanho: {len(barras)} caracteres')
    print(f'   Valor: {barras}')
    
    print(f'\nğŸ“± PIX (copia e cola):')
    print(f'   Tamanho: {len(pix)} caracteres')
    print(f'   Primeiros 100: {pix[:100]}...')

print(f'\n{"="*80}')
print('âœ… Teste finalizado')
print('='*80)

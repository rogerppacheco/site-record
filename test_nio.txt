from crm_app.nio_api import consultar_dividas_nio
import json

cpf = '12886868620'
print('='*80)
print(f'Consultando CPF: {cpf}')
print('='*80)

resultado = consultar_dividas_nio(cpf=cpf, limit=10)

print('\nRESULTADO COMPLETO (JSON):')
print(json.dumps(resultado, indent=2, ensure_ascii=False))

invoices = resultado.get('invoices', [])
print(f'\n{"="*80}')
print(f'TOTAL DE FATURAS: {len(invoices)}')
print('='*80)

for i, inv in enumerate(invoices, 1):
    print(f'\nFATURA {i}:')
    print(f'  Produto: {inv.get("product")}')
    print(f'  Valor: R$ {inv.get("amount")}')
    print(f'  Vencimento (raw): {inv.get("due_date_raw")}')
    print(f'  Vencimento (expiration): {inv.get("expiration")}')
    print(f'  Status: {inv.get("status")}')
    pix = inv.get('pix', '') or ''
    barras = inv.get('barcode', '') or ''
    print(f'  PIX ({len(pix)} chars): {pix[:80]}...')
    print(f'  Barras ({len(barras)} chars): {barras[:80]}...')

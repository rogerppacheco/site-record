{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Área Interna - Record PAP</title>
    
    <link rel="stylesheet" href="{% static 'css/custom_styles.css' %}">
</head>
<body>

    <header class="main-header">
        <div class="header-container">
            <a href="/"><img src="{% static 'logo.png' %}" alt="Record PAP Logo" class="logo"></a>
            <nav class="main-nav">
                <ul id="main-menu">
                    <li><a href="/">Início</a></li>
                    <li><a href="/#planos">Planos</a></li>
                    <li class="whatsapp-chat">
                        <a href="https://wa.me/31994588810" target="_blank" aria-label="Fale conosco no WhatsApp">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp">
                        </a>
                    </li>
                    <li><button id="logoutButton" class="nav-button logout-button">Sair</button></li>
                </ul>
            </nav>
            <button class="menu-toggle" id="menu-toggle" aria-label="Abrir menu">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </button>
        </div>
    </header>

    <main>
        <section class="area-interna-section">
            <div class="area-interna-container">
                <h1>Bem-vindo à Área Interna</h1>
                <p class="area-interna-subtitle">Selecione uma das opções abaixo para continuar.</p>
                <div class="button-group" id="botoes-area-interna">
                </div>
            </div>
        </section>
    </main>

    <footer id="contato">
        <p>Record PAP - Internet Fibra Ótica</p>
        <p>Contato: (31) 99458-8810 | E-mail: <a href="mailto:suporte@recordpap.com.br">suporte@recordpap.com.br</a></p>
        <p><a href="#">Política de Privacidade</a> | <a href="#">Termos de Uso</a></p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="{% static 'js/auth.js' %}"></script>
    <script src="{% static 'js/menu.js' %}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Script original da página (com links corrigidos)
            verificarAutenticacao();

            function jwt_decode(token) {
                try {
                    const base64Url = token.split('.')[1];
                    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                    const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                    }).join(''));
                    return JSON.parse(jsonPayload);
                } catch (e) { return null; }
            }

            const token = localStorage.getItem('accessToken');
            const decodedToken = jwt_decode(token);
            const userProfile = decodedToken ? decodedToken.perfil : null;

            if (!userProfile) {
                alert('Sessão inválida ou perfil não encontrado. Faça login novamente.');
                logout();
                return;
            }

            // URLs com / no final
            const permissoes = {
                'Admin': [
                    { texto: 'Controle de Presença', href: '/presenca/' },
                    { texto: 'Governança', href: '/governanca/' },
                    { texto: 'Esteira de Vendas', href: '/auditoria/' }
                ],
                'Vendedor': [
                    { texto: 'Esteira de Vendas', href: '/crm-vendas/' }
                ],
                'Supervisor': [
                    { texto: 'Controle de Presença', href: '/presenca/' },
                    { texto: 'Esteira de Vendas', href: '/auditoria/' }
                ],
                'Gerente': [
                    { texto: 'Controle de Presença', href: '/presenca/' },
                    { texto: 'Esteira de Vendas', href: '/auditoria/' }
                ],
                'BackOffice': [
                    { texto: 'Controle de Presença', href: '/presenca/' },
                    { texto: 'Esteira de Vendas', href: '/auditoria/' }
                ],
                'Diretoria': [
                    { texto: 'Controle de Presença', href: '/presenca/' },
                    { texto: 'Governança', href: '/governanca/' },
                    { texto: 'Esteira de Vendas', href: '/auditoria/' }
                ]
            };

            const containerBotoes = document.getElementById('botoes-area-interna');
            containerBotoes.innerHTML = '';

            const botoesPermitidos = permissoes[userProfile] || [];

            if (botoesPermitidos.length > 0) {
                botoesPermitidos.forEach(botaoInfo => {
                    const botao = document.createElement('a');
                    botao.href = botaoInfo.href;
                    botao.className = 'action-button';
                    botao.textContent = botaoInfo.texto;
                    containerBotoes.appendChild(botao);
                });
            } else {
                const p = document.createElement('p');
                p.textContent = 'Você não tem permissões de acesso definidas.';
                p.style.color = 'var(--cor-texto-secundaria)';
                containerBotoes.appendChild(p);
            }
            
            const logoutButton = document.getElementById('logoutButton');
            if (logoutButton) {
                logoutButton.addEventListener('click', () => { logout(); });
            }
        });
    </script>
</body>
</html>